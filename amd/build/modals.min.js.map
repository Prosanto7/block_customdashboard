{"version":3,"file":"modals.min.js","sources":["../src/modals.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript for modals in Custom Dashboard block.\n *\n * @module     block_customdashboard/modals\n * @copyright  2026\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/modal_factory', 'core/modal_events', 'core/str'], function($, ModalFactory, ModalEvents, Str) {\n    return {\n        init: function() {\n            // View Activities button handler\n            $('.view-activities').on('click', function() {\n                const courseId = $(this).data('courseid');\n                const courseName = $(this).data('coursename');\n                const activityData = $('.activity-data[data-courseid=\"' + courseId + '\"]');\n\n                // Load all required strings first\n                const stringPromises = [\n                    {key: 'activityname', component: 'block_customdashboard'},\n                    {key: 'activitytype', component: 'block_customdashboard'},\n                    {key: 'status', component: 'block_customdashboard'},\n                    {key: 'nocourses', component: 'block_customdashboard'},\n                    {key: 'activitiesfor', component: 'block_customdashboard', param: courseName}\n                ];\n\n                Str.get_strings(stringPromises).then(function(strings) {\n                    let activitiesHtml = '<table class=\"table table-striped\"><thead><tr>' +\n                        '<th>' + strings[0] + '</th>' +\n                        '<th>' + strings[1] + '</th>' +\n                        '<th>' + strings[2] + '</th>' +\n                        '</tr></thead><tbody>';\n\n                    if (activityData.find('.activity-item').length > 0) {\n                        activityData.find('.activity-item').each(function() {\n                            const name = $(this).data('name');\n                            const type = $(this).data('type');\n                            const completedText = $(this).data('completedtext');\n                            const completedClass = $(this).data('completedclass');\n\n                            activitiesHtml += '<tr>' +\n                                '<td>' + name + '</td>' +\n                                '<td>' + type + '</td>' +\n                                '<td><span class=\"badge ' + completedClass + '\">' + completedText + '</span></td>' +\n                                '</tr>';\n                        });\n                    } else {\n                        activitiesHtml += '<tr><td colspan=\"3\" class=\"text-center\">' +\n                            strings[3] + '</td></tr>';\n                    }\n\n                    activitiesHtml += '</tbody></table>';\n\n                    return ModalFactory.create({\n                        type: ModalFactory.types.DEFAULT,\n                        title: strings[4],\n                        body: activitiesHtml,\n                        large: true\n                    });\n                }).then(function(modal) {\n                    modal.show();\n                    return modal;\n                }).catch(function() {\n                    // Fallback if string loading fails\n                    let activitiesHtml = '<table class=\"table table-striped\"><thead><tr>' +\n                        '<th>Activity Name</th>' +\n                        '<th>Type</th>' +\n                        '<th>Status</th>' +\n                        '</tr></thead><tbody>';\n\n                    if (activityData.find('.activity-item').length > 0) {\n                        activityData.find('.activity-item').each(function() {\n                            const name = $(this).data('name');\n                            const type = $(this).data('type');\n                            const completedText = $(this).data('completedtext');\n                            const completedClass = $(this).data('completedclass');\n\n                            activitiesHtml += '<tr>' +\n                                '<td>' + name + '</td>' +\n                                '<td>' + type + '</td>' +\n                                '<td><span class=\"badge ' + completedClass + '\">' + completedText + '</span></td>' +\n                                '</tr>';\n                        });\n                    } else {\n                        activitiesHtml += '<tr><td colspan=\"3\" class=\"text-center\">No activities</td></tr>';\n                    }\n\n                    activitiesHtml += '</tbody></table>';\n\n                    return ModalFactory.create({\n                        type: ModalFactory.types.DEFAULT,\n                        title: 'Activities for ' + courseName,\n                        body: activitiesHtml\n                    }).then(function(modal) {\n                        modal.show();\n                    });\n                });\n            });\n\n            // View Grades button handler\n            $('.view-grades').on('click', function() {\n                const courseId = $(this).data('courseid');\n                const courseName = $(this).data('coursename');\n                const gradesData = $('.grades-data[data-courseid=\"' + courseId + '\"]');\n\n                // Load all required strings first\n                const stringPromises = [\n                    {key: 'activityname', component: 'block_customdashboard'},\n                    {key: 'grade', component: 'block_customdashboard'},\n                    {key: 'na', component: 'block_customdashboard'},\n                    {key: 'finalgrade', component: 'block_customdashboard'},\n                    {key: 'nocourses', component: 'block_customdashboard'},\n                    {key: 'gradesfor', component: 'block_customdashboard', param: courseName}\n                ];\n\n                Str.get_strings(stringPromises).then(function(strings) {\n                    let gradesHtml = '<table class=\"table table-striped\"><thead><tr>' +\n                        '<th>' + strings[0] + '</th>' +\n                        '<th>' + strings[1] + '</th>' +\n                        '</tr></thead><tbody>';\n\n                    if (gradesData.find('.grade-item').length > 0) {\n                        gradesData.find('.grade-item').each(function() {\n                            const name = $(this).data('name');\n                            const grade = $(this).data('grade');\n                            const hasGrade = $(this).data('hasgrade');\n                            const isScale = $(this).data('isscale');\n                            const scaleItemsStr = $(this).data('scaleitems');\n                            const achievedScale = $(this).data('achievedscale');\n                            const gradeMax = $(this).data('grademax');\n\n                            let gradeDisplay = '';\n\n                            if (!hasGrade) {\n                                gradeDisplay = '<span class=\"text-muted\">' + strings[2] + '</span>';\n                            } else if (isScale) {\n                                // For scales, show achieved scale with all available scales.\n                                const scaleItems = scaleItemsStr ? scaleItemsStr.split(',').filter(item => item.trim()) : [];\n                                gradeDisplay = '<strong>' + achievedScale + '</strong><br>';\n                                gradeDisplay += '<small class=\"text-muted\">Scale: ' + scaleItems.join(', ') + '</small>';\n                            } else {\n                                // For numeric grades, show achieved out of max.\n                                gradeDisplay = '<strong>' + Number(grade).toFixed(2)\n                                + '</strong> (out of <strong>' + Number(gradeMax).toFixed(2) + '</strong>)';\n                            }\n\n                            gradesHtml += '<tr>' +\n                                '<td>' + name + '</td>' +\n                                '<td>' + gradeDisplay + '</td>' +\n                                '</tr>';\n                        });\n\n                        // Add final grade row\n                        const finalGrade = gradesData.data('finalgrade');\n                        const finalGradeText = gradesData.data('finalgradetext');\n\n                        gradesHtml += '<tr class=\"table-primary\"><td><strong>' +\n                            strings[3] +\n                            '</strong></td><td><strong>' + finalGrade + ' (' + finalGradeText + ')</strong></td></tr>';\n                    } else {\n                        gradesHtml += '<tr><td colspan=\"2\" class=\"text-center\">' +\n                            strings[4] + '</td></tr>';\n                    }\n\n                    gradesHtml += '</tbody></table>';\n\n                    return ModalFactory.create({\n                        type: ModalFactory.types.DEFAULT,\n                        title: strings[5],\n                        body: gradesHtml\n                    });\n                }).then(function(modal) {\n                    modal.show();\n                    return modal;\n                }).catch(function() {\n                    // Fallback if string loading fails\n                    let gradesHtml = '<table class=\"table table-striped\"><thead><tr>' +\n                        '<th>Activity Name</th>' +\n                        '<th>Grade</th>' +\n                        '</tr></thead><tbody>';\n\n                    if (gradesData.find('.grade-item').length > 0) {\n                        gradesData.find('.grade-item').each(function() {\n                            const name = $(this).data('name');\n                            const grade = $(this).data('grade');\n                            const hasGrade = $(this).data('hasgrade');\n                            const isScale = $(this).data('isscale');\n                            const scaleItemsStr = $(this).data('scaleitems');\n                            const achievedScale = $(this).data('achievedscale');\n                            const gradeMax = $(this).data('grademax');\n\n                            let gradeDisplay = '';\n\n                            if (!hasGrade) {\n                                gradeDisplay = '<span class=\"text-muted\">N/A</span>';\n                            } else if (isScale) {\n                                const scaleItems = scaleItemsStr ? scaleItemsStr.split(',').filter(item => item.trim()) : [];\n                                gradeDisplay = '<strong>' + achievedScale + '</strong><br>';\n                                gradeDisplay += '<small class=\"text-muted\">Scale: ' + scaleItems.join(', ') + '</small>';\n                            } else {\n                                gradeDisplay = '<strong>' + grade + '</strong> (out of <strong>' + gradeMax + '</strong>)';\n                            }\n\n                            gradesHtml += '<tr>' +\n                                '<td>' + name + '</td>' +\n                                '<td>' + gradeDisplay + '</td>' +\n                                '</tr>';\n                        });\n\n                        // Add final grade row\n                        const finalGrade = gradesData.data('finalgrade');\n                        const finalGradeText = gradesData.data('finalgradetext');\n\n                        gradesHtml += '<tr class=\"table-primary\"><td><strong>Final Grade</strong></td>' +\n                            '<td><strong>' + finalGrade + ' (' + finalGradeText + ')</strong></td></tr>';\n                    } else {\n                        gradesHtml += '<tr><td colspan=\"2\" class=\"text-center\">No grades</td></tr>';\n                    }\n\n                    gradesHtml += '</tbody></table>';\n\n                    return ModalFactory.create({\n                        type: ModalFactory.types.DEFAULT,\n                        title: 'Grades for ' + courseName,\n                        body: gradesHtml,\n                        large: true\n                    }).then(function(modal) {\n                        modal.show();\n                    });\n                });\n            });\n        }\n    };\n});\n"],"names":["define","$","ModalFactory","ModalEvents","Str","init","on","courseId","this","data","courseName","activityData","stringPromises","key","component","param","get_strings","then","strings","activitiesHtml","find","length","each","name","type","completedText","completedClass","create","types","DEFAULT","title","body","large","modal","show","catch","gradesData","gradesHtml","grade","hasGrade","isScale","scaleItemsStr","achievedScale","gradeMax","gradeDisplay","split","filter","item","trim","join","Number","toFixed","finalGrade","finalGradeText"],"mappings":";;;;;;;AAuBAA,sCAAO,CAAC,SAAU,qBAAsB,oBAAqB,aAAa,SAASC,EAAGC,aAAcC,YAAaC,WACtG,CACHC,KAAM,WAEFJ,EAAE,oBAAoBK,GAAG,SAAS,iBACxBC,SAAWN,EAAEO,MAAMC,KAAK,YACxBC,WAAaT,EAAEO,MAAMC,KAAK,cAC1BE,aAAeV,EAAE,iCAAmCM,SAAW,MAG/DK,eAAiB,CACnB,CAACC,IAAK,eAAgBC,UAAW,yBACjC,CAACD,IAAK,eAAgBC,UAAW,yBACjC,CAACD,IAAK,SAAUC,UAAW,yBAC3B,CAACD,IAAK,YAAaC,UAAW,yBAC9B,CAACD,IAAK,gBAAiBC,UAAW,wBAAyBC,MAAOL,aAGtEN,IAAIY,YAAYJ,gBAAgBK,MAAK,SAASC,aACtCC,eAAiB,qDACRD,QAAQ,GADA,YAERA,QAAQ,GAFA,YAGRA,QAAQ,GAHA,mCAMjBP,aAAaS,KAAK,kBAAkBC,OAAS,EAC7CV,aAAaS,KAAK,kBAAkBE,MAAK,iBAC/BC,KAAOtB,EAAEO,MAAMC,KAAK,QACpBe,KAAOvB,EAAEO,MAAMC,KAAK,QACpBgB,cAAgBxB,EAAEO,MAAMC,KAAK,iBAC7BiB,eAAiBzB,EAAEO,MAAMC,KAAK,kBAEpCU,gBAAkB,WACLI,KADK,YAELC,KAFK,+BAGcE,eAAiB,KAAOD,cAHtC,uBAOtBN,gBAAkB,2CACdD,QAAQ,GAAK,aAGrBC,gBAAkB,mBAEXjB,aAAayB,OAAO,CACvBH,KAAMtB,aAAa0B,MAAMC,QACzBC,MAAOZ,QAAQ,GACfa,KAAMZ,eACNa,OAAO,OAEZf,MAAK,SAASgB,cACbA,MAAMC,OACCD,SACRE,OAAM,eAEDhB,eAAiB,8HAMjBR,aAAaS,KAAK,kBAAkBC,OAAS,EAC7CV,aAAaS,KAAK,kBAAkBE,MAAK,iBAC/BC,KAAOtB,EAAEO,MAAMC,KAAK,QACpBe,KAAOvB,EAAEO,MAAMC,KAAK,QACpBgB,cAAgBxB,EAAEO,MAAMC,KAAK,iBAC7BiB,eAAiBzB,EAAEO,MAAMC,KAAK,kBAEpCU,gBAAkB,WACLI,KADK,YAELC,KAFK,+BAGcE,eAAiB,KAAOD,cAHtC,uBAOtBN,gBAAkB,kEAGtBA,gBAAkB,mBAEXjB,aAAayB,OAAO,CACvBH,KAAMtB,aAAa0B,MAAMC,QACzBC,MAAO,kBAAoBpB,WAC3BqB,KAAMZ,iBACPF,MAAK,SAASgB,OACbA,MAAMC,gBAMlBjC,EAAE,gBAAgBK,GAAG,SAAS,iBACpBC,SAAWN,EAAEO,MAAMC,KAAK,YACxBC,WAAaT,EAAEO,MAAMC,KAAK,cAC1B2B,WAAanC,EAAE,+BAAiCM,SAAW,MAG3DK,eAAiB,CACnB,CAACC,IAAK,eAAgBC,UAAW,yBACjC,CAACD,IAAK,QAASC,UAAW,yBAC1B,CAACD,IAAK,KAAMC,UAAW,yBACvB,CAACD,IAAK,aAAcC,UAAW,yBAC/B,CAACD,IAAK,YAAaC,UAAW,yBAC9B,CAACD,IAAK,YAAaC,UAAW,wBAAyBC,MAAOL,aAGlEN,IAAIY,YAAYJ,gBAAgBK,MAAK,SAASC,aACtCmB,WAAa,qDACJnB,QAAQ,GADJ,YAEJA,QAAQ,GAFJ,+BAKbkB,WAAWhB,KAAK,eAAeC,OAAS,EAAG,CAC3Ce,WAAWhB,KAAK,eAAeE,MAAK,iBAC1BC,KAAOtB,EAAEO,MAAMC,KAAK,QACpB6B,MAAQrC,EAAEO,MAAMC,KAAK,SACrB8B,SAAWtC,EAAEO,MAAMC,KAAK,YACxB+B,QAAUvC,EAAEO,MAAMC,KAAK,WACvBgC,cAAgBxC,EAAEO,MAAMC,KAAK,cAC7BiC,cAAgBzC,EAAEO,MAAMC,KAAK,iBAC7BkC,SAAW1C,EAAEO,MAAMC,KAAK,gBAE1BmC,aAAe,MAEdL,SAEE,GAAIC,QAAS,CAGhBI,aAAe,WAAaF,cAAgB,gBAC5CE,cAAgB,qCAFGH,cAAgBA,cAAcI,MAAM,KAAKC,QAAOC,MAAQA,KAAKC,SAAU,IAEzBC,KAAK,MAAQ,gBAG9EL,aAAe,WAAaM,OAAOZ,OAAOa,QAAQ,GAChD,6BAA+BD,OAAOP,UAAUQ,QAAQ,GAAK,kBAT/DP,aAAe,4BAA8B1B,QAAQ,GAAK,UAY9DmB,YAAc,WACDd,KADC,YAEDqB,aAFC,sBAOZQ,WAAahB,WAAW3B,KAAK,cAC7B4C,eAAiBjB,WAAW3B,KAAK,kBAEvC4B,YAAc,yCACVnB,QAAQ,GACR,6BAA+BkC,WAAa,KAAOC,eAAiB,4BAExEhB,YAAc,2CACVnB,QAAQ,GAAK,oBAGrBmB,YAAc,mBAEPnC,aAAayB,OAAO,CACvBH,KAAMtB,aAAa0B,MAAMC,QACzBC,MAAOZ,QAAQ,GACfa,KAAMM,gBAEXpB,MAAK,SAASgB,cACbA,MAAMC,OACCD,SACRE,OAAM,eAEDE,WAAa,4GAKbD,WAAWhB,KAAK,eAAeC,OAAS,EAAG,CAC3Ce,WAAWhB,KAAK,eAAeE,MAAK,iBAC1BC,KAAOtB,EAAEO,MAAMC,KAAK,QACpB6B,MAAQrC,EAAEO,MAAMC,KAAK,SACrB8B,SAAWtC,EAAEO,MAAMC,KAAK,YACxB+B,QAAUvC,EAAEO,MAAMC,KAAK,WACvBgC,cAAgBxC,EAAEO,MAAMC,KAAK,cAC7BiC,cAAgBzC,EAAEO,MAAMC,KAAK,iBAC7BkC,SAAW1C,EAAEO,MAAMC,KAAK,gBAE1BmC,aAAe,MAEdL,SAEE,GAAIC,QAAS,CAEhBI,aAAe,WAAaF,cAAgB,gBAC5CE,cAAgB,qCAFGH,cAAgBA,cAAcI,MAAM,KAAKC,QAAOC,MAAQA,KAAKC,SAAU,IAEzBC,KAAK,MAAQ,gBAE9EL,aAAe,WAAaN,MAAQ,6BAA+BK,SAAW,kBAN9EC,aAAe,sCASnBP,YAAc,WACDd,KADC,YAEDqB,aAFC,sBAOZQ,WAAahB,WAAW3B,KAAK,cAC7B4C,eAAiBjB,WAAW3B,KAAK,kBAEvC4B,YAAc,8EACOe,WAAa,KAAOC,eAAiB,4BAE1DhB,YAAc,qEAGlBA,YAAc,mBAEPnC,aAAayB,OAAO,CACvBH,KAAMtB,aAAa0B,MAAMC,QACzBC,MAAO,cAAgBpB,WACvBqB,KAAMM,WACNL,OAAO,IACRf,MAAK,SAASgB,OACbA,MAAMC"}