{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template block_customdashboard/coursecard

    This template renders a single course card for the customdashboard block.

    Context variables required for this template:
    * id - Course ID
    * fullname - Course fullname
    * viewurl - URL to course
    * courseimage - Course image URL
    * hasprogress - Boolean if progress tracking is enabled
    * progress - Progress percentage
}}
<div class="card course-card mx-1" role="listitem"
    data-region="course-content"
    data-course-id="{{{id}}}">
    <a href="{{viewurl}}" tabindex="-1" target="_blank">
        <div class="card-img-top" style='background-image: url("{{{courseimage}}}");'>
            <span class="visually-hidden">{{fullname}}</span>
        </div>
    </a>
    <div class="card-body course-info-container" id="course-info-container-{{id}}-{{uniqid}}">
        <div class="d-flex align-items-start">
            <div class="w-100 text-truncate">
                <a href="{{viewurl}}" class="aalink coursename me-2 mb-1" target="_blank">
                    <span class="visually-hidden">
                        {{#str}}aria:coursename, core_course{{/str}}
                    </span>
                    <span class="multiline" title="{{fullname}}">
                        <span class="visually-hidden">{{{fullname}}}</span>
                        <span aria-hidden="true">
                            {{#shortentext}}55, {{{fullname}}} {{/shortentext}}
                        </span>
                    </span>
                </a>
                <div class="text-muted muted d-flex flex-wrap">
                    {{#coursecategory}}
                        <span class="visually-hidden">
                            {{#str}}aria:coursecategory, core_course{{/str}}
                        </span>
                        <span class="categoryname text-truncate">
                            {{#pix}}i/course, core{{/pix}}
                            {{{coursecategory}}}
                        </span>
                    {{/coursecategory}}
                </div>
            </div>
        </div>

        {{! Hidden data for modals }}
        {{#hasactivities}}
        <div class="activity-data" data-courseid="{{id}}" style="display:none;">
            {{#activities}}
            <div class="activity-item" data-name="{{name}}" data-type="{{type}}" 
                 data-modname="{{modname}}" data-iconurl="{{iconurl}}"
                 data-completed="{{completed}}" data-completedtext="{{completedtext}}" 
                 data-completedclass="{{completedclass}}"></div>
            {{/activities}}
        </div>
        {{/hasactivities}}

        {{#hasgradeslist}}
        <div class="grades-data" data-courseid="{{id}}" style="display:none;" 
             data-finalgrade="{{finalgrade}}" data-finalgradetext="{{finalgradetext}}">
            {{#gradeslist}}
            <div class="grade-item" data-name="{{name}}" data-grade="{{grade}}" 
                 data-hasgrade="{{hasgrade}}" data-isscale="{{isscale}}"
                 data-scaleitems="{{#scaleitems}}{{.}},{{/scaleitems}}"
                 data-achievedscale="{{achievedscale}}"
                 data-grademax="{{grademax}}"
                 data-gradevalue="{{gradevalue}}"></div>
            {{/gradeslist}}
        </div>
        {{/hasgradeslist}}
        
        {{! Action buttons }}
        <div class="mt-3 d-flex justify-content-center align-items-center gap-2">
            <button class="btn btn-sm btn-primary view-activities" 
                data-courseid="{{id}}" data-coursename="{{fullname}}">
                {{#pix}}i/report, core{{/pix}}
                {{#str}}viewactivities, block_customdashboard{{/str}}
            </button>
            <button class="btn btn-sm btn-primary view-grades" 
                data-courseid="{{id}}" data-coursename="{{fullname}}">
                {{#pix}}i/chartbar, core{{/pix}}
                {{#str}}viewgrades, block_customdashboard{{/str}}
            </button>
        </div>
    </div>
    {{#hasprogress}}
        <div class="card-footer border-0 bg-white w-100">
            {{> block_customdashboard/progress-bar}}
        </div>
    {{/hasprogress}}
</div>
